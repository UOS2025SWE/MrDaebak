@startuml
title "Backend API Gateway - FastAPI Monolith (Gateway View)"

skinparam classAttributeIconSize 0
skinparam defaultFontName "Malgun Gothic"
skinparam shadowing false
skinparam linetype ortho

interface "Next.js Frontend\n(port 3000)" as IFrontend {
  + HTTP/HTTPS 요청
  + WebSocket 연결
}

interface "PostgreSQL Database" as IDatabase

class "BackendAPI\n(backend/app.py)" as BackendAPI {
  + FastAPI app
  + lifespan: init_database()
  ---
  **Middleware**
  + CORSMiddleware
  ---
  **Routers**
  + /api/ws (WebSocketRouter)
  + /api/auth (AuthRouter)
  + /api/menu (MenuRouter)
  + /api/orders (OrderRouter)
  + /api/discount (DiscountRouter)
  + /api/admin (AdminRouter)
  + /api/voice (VoiceRouter)
  + /api/staff (StaffRouter)
  + /api/ingredients (IngredientsRouter)
  + /api/side-dishes (SideDishesRouter)
  + /api/cake (CakeRouter)
  + /api/checkout (CheckoutRouter)
  + /api/events (EventsRouter)
  + /api/inquiries (InquiriesRouter)
}

class "AuthRouter\n(routers/auth.py)" as AuthRouter
class "MenuRouter\n(routers/menu.py)" as MenuRouter
class "OrderRouter\n(routers/order.py)" as OrderRouter
class "CheckoutRouter\n(routers/checkout.py)" as CheckoutRouter
class "DiscountRouter\n(routers/discount.py)" as DiscountRouter
class "EventsRouter\n(routers/events.py)" as EventsRouter
class "IngredientsRouter\n(routers/ingredients.py)" as IngredientsRouter
class "SideDishesRouter\n(routers/side_dishes.py)" as SideDishesRouter
class "StaffRouter\n(routers/staff.py)" as StaffRouter
class "VoiceRouter\n(routers/voice.py)" as VoiceRouter
class "CakeRouter\n(routers/cake.py)" as CakeRouter
class "InquiryRouter\n(routers/inquiries.py)" as InquiryRouter
class "AdminRouter\n(routers/admin.py)" as AdminRouter
class "WebSocketRouter\n(routers/websocket.py)" as WebSocketRouter

class "OrderService\n(services/order_service.py)" as OrderService
class "PaymentService\n(services/payment_service.py)" as PaymentService
class "DiscountService\n(services/discount_service.py)" as DiscountService
class "EventService\n(services/event_service.py)" as EventService
class "MenuService\n(services/menu_service.py)" as MenuService
class "IngredientService\n(services/ingredient_service.py)" as IngredientService
class "StaffService\n(services/staff_service.py)" as StaffService
class "SideDishService\n(services/side_dish_service.py)" as SideDishService
class "InquiryService\n(services/inquiry_service.py)" as InquiryService
class "LoginService\n(services/login_service.py)" as LoginService
class "GeminiService\n(services/gemini_service.py)" as GeminiService
class "OpenAIAudioService\n(services/openai_audio_service.py)" as OpenAIAudioService
class "WebSocketManager\n(services/websocket_manager.py)" as WebSocketManager
class "Database\n(services/database.py)" as Database

IFrontend -> BackendAPI : HTTP/WS 요청
BackendAPI ..> IFrontend : React 프록시

BackendAPI *-- AuthRouter
BackendAPI *-- MenuRouter
BackendAPI *-- OrderRouter
BackendAPI *-- CheckoutRouter
BackendAPI *-- DiscountRouter
BackendAPI *-- EventsRouter
BackendAPI *-- IngredientsRouter
BackendAPI *-- SideDishesRouter
BackendAPI *-- StaffRouter
BackendAPI *-- VoiceRouter
BackendAPI *-- CakeRouter
BackendAPI *-- InquiryRouter
BackendAPI *-- AdminRouter
BackendAPI *-- WebSocketRouter

AuthRouter ..> LoginService
MenuRouter ..> MenuService
OrderRouter ..> OrderService
OrderRouter ..> PaymentService
OrderRouter ..> DiscountService
OrderRouter ..> LoginService
OrderRouter ..> WebSocketManager
CheckoutRouter ..> OrderService
CheckoutRouter ..> PaymentService
CheckoutRouter ..> DiscountService
DiscountRouter ..> DiscountService
EventsRouter ..> EventService
EventsRouter ..> LoginService
IngredientsRouter ..> IngredientService
SideDishesRouter ..> SideDishService
StaffRouter ..> StaffService
VoiceRouter ..> GeminiService
VoiceRouter ..> OpenAIAudioService
VoiceRouter ..> OrderService
VoiceRouter ..> PaymentService
VoiceRouter ..> DiscountService
CakeRouter ..> OrderService
InquiryRouter ..> InquiryService
InquiryRouter ..> LoginService
WebSocketRouter ..> WebSocketManager
WebSocketRouter ..> LoginService

LoginService ..> IDatabase
OrderService ..> IDatabase
PaymentService ..> IDatabase
DiscountService ..> IDatabase
EventService ..> IDatabase
MenuService ..> IDatabase
IngredientService ..> IDatabase
StaffService ..> IDatabase
SideDishService ..> IDatabase
InquiryService ..> IDatabase
Database ..> IDatabase

note right of BackendAPI
  **API Gateway View**
  - 라우터별로 도메인 서비스에 위임
  - /api/* 이외 경로는 Next.js로 프록시
  - WebSocket은 /api/ws 에서 JWT 기반 인증
end note

@enduml


