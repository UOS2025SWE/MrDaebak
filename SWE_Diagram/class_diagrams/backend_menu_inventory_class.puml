@startuml
title "Backend Menu / Side Dish / Inventory - 클래스 다이어그램"

skinparam classAttributeIconSize 0
skinparam defaultFontName "Malgun Gothic"
skinparam shadowing false
skinparam linetype ortho

interface "PostgreSQL Database" as IDatabase {
  + menu_items
  + serving_styles
  + menu_serving_style_availability
  + menu_base_ingredients
  + ingredients
  + ingredient_pricing
  + store_inventory
  + side_dishes
  + custom_cake_recipes
}

class "MenuRouter\n(routers/menu.py)" as MenuRouter {
  + GET /api/menu
  + GET /api/menu/styles
}

class "IngredientsRouter\n(routers/ingredients.py)" as IngredientsRouter {
  + GET /api/ingredients/store\nget_store_inventory()
}

class "SideDishesRouter\n(routers/side_dishes.py)" as SideDishesRouter {
  + GET /api/side-dishes\nlist_side_dishes()
}

class "MenuService\n(services/menu_service.py)" as MenuService {
  + get_menu_data(db): dict
  + get_base_ingredients(db, dinner_code, style): dict
  + get_cooking_time(dinner_code, style): int
}

class "IngredientService\n(services/ingredient_service.py)" as IngredientService {
  + get_store_inventory(db, store_id): list
}

class "SideDishService\n(services/side_dish_service.py)" as SideDishService {
  + get_side_dish_by_code(db, code): dict
  + get_custom_cake_recipe_variant(db, flavor, size): list
  + CUSTOM_CAKE_CODE = "custom_cake"
}

class "MenuItem (Entity)\nmenu_items" as MenuItemEntity {
  - menu_item_id: UUID <<PK>>
  - code: TEXT
  - name: TEXT
  - description: TEXT
  - base_price: NUMERIC
  - is_available: BOOLEAN
}

class "ServingStyle (Entity)\nserving_styles" as ServingStyleEntity {
  - serving_style_id: UUID <<PK>>
  - name: TEXT
  - description: TEXT
  - price_modifier: NUMERIC
}

class "MenuServingStyleAvailability\nmenu_serving_style_availability" as MenuStyleAvailEntity {
  - menu_item_id: UUID <<PK>>
  - serving_style_id: UUID <<PK>>
}

class "MenuBaseIngredient\nmenu_base_ingredients" as MenuBaseIngredientEntity {
  - menu_code: TEXT <<PK>>
  - style: TEXT <<PK>>
  - ingredient_code: TEXT <<PK>>
  - base_quantity: INT
}

class "Ingredient (Entity)\ningredients" as IngredientEntity {
  - ingredient_id: UUID <<PK>>
  - name: TEXT
  - unit: TEXT
}

class "IngredientPricing\ningredient_pricing" as IngredientPricingEntity {
  - ingredient_code: TEXT <<PK>>
  - unit_price: NUMERIC
}

class "StoreInventory\nstore_inventory" as StoreInventoryEntity {
  - store_id: UUID <<PK>>
  - ingredient_id: UUID <<PK>>
  - quantity_on_hand: NUMERIC
}

class "SideDish (Entity)\nside_dishes" as SideDishEntity {
  - side_dish_id: UUID <<PK>>
  - code: TEXT
  - name: TEXT
  - description: TEXT
  - base_price: NUMERIC
  - is_available: BOOLEAN
  - created_by: UUID
}

class "CustomCakeRecipe\ncustom_cake_recipes" as CustomCakeRecipeEntity {
  - recipe_id: UUID <<PK>>
  - flavor: TEXT
  - size: TEXT
  - ingredient_code: TEXT
  - quantity: NUMERIC
}

MenuRouter ..> MenuService
IngredientsRouter ..> IngredientService
SideDishesRouter ..> SideDishService

MenuService ..> IDatabase
IngredientService ..> IDatabase
SideDishService ..> IDatabase

MenuStyleAvailEntity "0..*" -- "1" MenuItemEntity
MenuStyleAvailEntity "0..*" -- "1" ServingStyleEntity

MenuBaseIngredientEntity "0..*" -- "1" IngredientEntity : "ingredient_code"

IngredientPricingEntity "1" -- "1" IngredientEntity : "code:name"

StoreInventoryEntity "0..*" -- "1" IngredientEntity

CustomCakeRecipeEntity "0..*" -- "1" IngredientEntity : "케이크 재료"

note right of MenuService
  **메뉴/스타일 구성**
  - menu_items + serving_styles + menu_serving_style_availability 조합으로
    제공 가능한 디너/스타일 조합 계산
  - menu_base_ingredients 로 기본 재료 구성 제공
end note

note right of SideDishService
  **사이드 / 커스텀 케이크**
  - side_dishes 기반 사이드 메뉴 조회
  - custom_cake_recipes로 맛/사이즈별 케이크 레시피 제공
end note

note right of IngredientService
  **매장 재고 조회**
  - store_inventory + ingredients 를 조인하여
    매장별 재고 현황을 관리자 화면에 제공
end note

@enduml


