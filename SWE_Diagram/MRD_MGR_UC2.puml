@startuml
title "MRD-MGR-UC2: 직원 관리 (Manage Staff) 교류도"

actor "매니저 (Manager)" as M
participant "Admin App\n(Next.js)" as AdminApp
participant "API Gateway\n(FastAPI)" as GW
participant "User Service\n(FastAPI)" as UserSvc
database "PostgreSQL\n(User Schema)" as DB

skinparam ParticipantPadding 20
skinparam BoxPadding 10

' --- (전제) 매니저 로그인 및 권한 확인 ---
M -> AdminApp: (1) '직원 관리' 메뉴 클릭 [cite: 54]
activate AdminApp
AdminApp -> AdminApp: (RBACWrapper) (useAdminAuth) \n'Manager' 권한 확인 [cite: 148, 149]
AdminApp --> M: (권한 확인) 직원 목록 페이지 렌더링
deactivate AdminApp

' --- 1. (주 흐름) 신규 직원 등록 ---
group (주 흐름) 신규 직원 등록
    M -> AdminApp: (3) '신규 직원 등록' 버튼 클릭 [cite: 55]
    activate AdminApp
    AdminApp --> M: 신규 직원 정보 양식 표시
    M -> AdminApp: (5) 정보 입력(ID, Role 등) 후 '저장' [cite: 55]

    AdminApp -> GW: POST /admin/staff [cite: 155]
    activate GW
    GW -> UserSvc: (라우팅) create_staff(data) [cite: 157]
    activate UserSvc
    UserSvc -> UserSvc: (AuthService) 비밀번호 해시
    UserSvc -> DB: (UserRepository) create_user(role='Staff') [cite: 157]
    activate DB
    DB --> UserSvc: (Success)
    deactivate DB
    UserSvc --> GW: (Success 201, 계정 생성됨)
    deactivate UserSvc
    GW --> AdminApp: (Success 201)
    deactivate GW
    AdminApp --> M: "계정이 생성되었습니다." (사후 조건 [cite: 53])
    deactivate AdminApp
end

' --- 2. (부 흐름) 계정 수정 ---
group (부 흐름) 계정 수정 [cite: 55-57]
    M -> AdminApp: (1) 특정 직원 '수정' 클릭 [cite: 55]
    activate AdminApp
    AdminApp --> M: (2) 정보 수정 폼(권한 등) 표시 [cite: 56]
    M -> AdminApp: (3) 권한을 'Manager'로 변경 후 '저장' [cite: 56]

    AdminApp -> GW: (추정) PUT /admin/staff/{id} (Body: "role": "Manager")
    activate GW
    GW -> UserSvc: (라우팅) (추정) update_staff_role(id, data)
    activate UserSvc
    UserSvc -> DB: (UserRepository) (4) UPDATE users SET role='Manager' [cite: 57]
    activate DB
    DB --> UserSvc: (Success)
    deactivate DB
    UserSvc --> GW: (Success)
    deactivate UserSvc
    GW --> AdminApp: (Success)
    deactivate GW
    AdminApp --> M: "권한이 업데이트되었습니다." (사후 조건 [cite: 54])
    deactivate AdminApp
end

' --- 3. (부 흐름) 계정 삭제 ---
group (부 흐름) 계정 삭제 [cite: 57-59]
    M -> AdminApp: (1) 특정 직원 '삭제' 클릭 [cite: 57]
    activate AdminApp
    AdminApp --> M: (2) "정말로... 삭제하시겠습니까?" 팝업 [cite: 58]
    M -> AdminApp: (3) '확인' 클릭 [cite: 58]

    AdminApp -> GW: (추정) DELETE /admin/staff/{id}
    activate GW
    GW -> UserSvc: (라우팅) (추정) delete_staff(id)
    activate UserSvc
    UserSvc -> DB: (UserRepository) (4) DELETE FROM users... [cite: 59]
    activate DB
    DB --> UserSvc: (Success)
    deactivate DB
    UserSvc --> GW: (Success)
    deactivate UserSvc
    GW --> AdminApp: (Success)
    deactivate GW
    AdminApp --> M: "계정이 삭제되었습니다." (사후 조건 [cite: 54])
    deactivate AdminApp
end
@enduml