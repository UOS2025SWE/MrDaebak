@startuml
title "User Service 서브시스템 - 클래스 다이어그램"

skinparam classAttributeIconSize 0
skinparam defaultFontName "Malgun Gothic"
skinparam shadowing false
skinparam allowmixing ' <--- 오류 해결: class, interface, database 요소 혼합 허용

' --- External Dependencies ---
interface "IApiGateway" {
  + Request
}

' --- User Service and its internal components ---
class "UserService (FastAPI App)" {
  + handleRequest(request)
}

class "UserRouter" {
  + register(data)
  + login(data)
  + get_me()
  + update_me(data)
  + create_staff(data)
}

class "AuthService" {
  + create_jwt(user)
  + verify_password(plain, hashed)
  + hash_password(password)
}

class "UserRepository" {
  + create_user(data, hashed_pass)
  + get_user_by_email(email)
  + update_profile(user_id, data)
}

' --- Relationships ---
' The main app receives requests and uses the router
IApiGateway -> "UserService (FastAPI App)" : "HTTP Request"
"UserService (FastAPI App)" *-- "UserRouter" : "1. 라우팅"

' The Router depends on (delegates to) the services and repository
UserRouter ..> AuthService : "JWT 생성/검증 요청"
UserRouter ..> UserRepository : "DB 작업 요청"

' The Repository interacts with the database
UserRepository ..> UserDB : "SQL Query"


' --- Notes for endpoint mapping ---
note "POST /auth/register\nPOST /auth/login\nGET /users/me\nPUT /users/me\nPOST /admin/staff" as Endpoints
UserRouter .. Endpoints

@enduml