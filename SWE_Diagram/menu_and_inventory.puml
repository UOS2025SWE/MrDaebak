@startuml
title "Menu & Inventory Service 서브시스템 - 클래스 다이어그램"

skinparam classAttributeIconSize 0
skinparam defaultFontName "Malgun Gothic"
skinparam shadowing false


' --- External Dependencies ---
interface "IApiGateway" {
  + Request
}
' Order Service는 /inventory/decrement 엔드포인트를 호출합니다.
interface "IOrderService" {
  + (Calls /inventory/decrement)
}


' --- Service Components ---
class "MenuService (FastAPI App)" {
  + handleRequest(request)
}

class "MenuRouter" {
  + get_menu()
  + get_inventory()
  ' Manager Only
  + update_stock(data)
  ' Internal Use Only
  + decrement_stock(items)
}

class "MenuRepository" {
  + get_public_menu_list(): Product[]
  + get_full_inventory_list(): InventoryItem[]
  + update_inventory_item(item_id, new_quantity): InventoryItem
  + atomic_decrement_stock(items_list): bool
}

' --- Data Entities ---
entity "Product" {
  + product_id: UUID
  + name: string
  + price: float
  + description: string
  + image_url: string
  + is_visible: bool ' 고객용 메뉴 구분
}

entity "InventoryItem" {
  + item_id: UUID (PK/FK -> Product)
  + quantity: int
  + threshold: int ' 재고 부족 알림 기준
}

' --- Relationships ---
IApiGateway -> "MenuService (FastAPI App)" : "HTTP Request"
' Order Service는 Gateway를 통해 이 서비스를 호출합니다.
IOrderService ..> IApiGateway : "Req /inventory/decrement"

"MenuService (FastAPI App)" *-- "MenuRouter" : "1. 라우팅"

' Router delegates logic to Repository
MenuRouter ..> MenuRepository : "DB 작업 요청"

' Repository interacts with DB
MenuRepository ..> ProductDB : "SQL Query"
MenuRepository o-- "Product" : "조회"
MenuRepository o-- "InventoryItem" : "조회/수정"

' Entity relationships
"Product" "1" -- "1" "InventoryItem" : "has stock"

' --- Notes for endpoint mapping ---
note "GET /menu\nGET /inventory\nPUT /inventory/update\nPOST /inventory/decrement" as Endpoints
MenuRouter .. Endpoints

@enduml