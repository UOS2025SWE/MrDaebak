@startuml
title "Dinner Service - Docker Based Deployment Diagram"

skinparam linestyle ortho
skinparam node {
    BackgroundColor White
    BorderColor Black
}
skinparam component {
    BackgroundColor White
    BorderColor Black
}
skinparam artifact {
    BackgroundColor White
    BorderColor Black
}

' ==========================================
' 1. 컴포넌트 (Component View)
' ==========================================
component "Customer Web App\n(from Component View)" as CustomerApp
component "Admin & Staff Web App\n(from Component View)" as AdminApp
component "Common Components\n(from Component View)" as CommonComp

component "API Routers\n(from Component View)" as ApiRouters
component "Domain Services\n(from Component View)" as DomainServices
component "Integration & Realtime\n(from Component View)" as IntegrationRealtime
component "Persistence\n(from Component View)" as Persistence

component "LLM\n(from Component View)" as LLM
component "Stable Diffusion\n(from Component View)" as StableDiffusion
component "STT\n(from Component View)" as STT
component "TTS\n(from Component View)" as TTS


' ==========================================
' 2. 아티팩트 (Artifacts)
' ==========================================
artifact "next-app.js\n(Next.js Server)" as NextServer
artifact "build/\n(Static Assets)" as BuildDir

artifact "main.py\n(FastAPI App)" as MainPy
artifact "uvicorn\n(ASGI Server)" as Uvicorn

artifact "postgres\n(PostgreSQL 17)" as PostgresExe
artifact "pgdata/\n(Database Files)" as PgData

artifact "caddy\n(Reverse Proxy)" as CaddyExe
artifact "Caddyfile\n(Routing Config)" as CaddyConf


' ==========================================
' 3. 노드 (Nodes)
' ==========================================
node "Client Browser\n(Desktop / Mobile)" as ClientBrowser

node "Frontend Container\n(dinner_service-frontend)" as FrontendContainer

node "Backend Container\n(dinner_service-backend)" as BackendContainer

node "Database Container\n(dinner_service_db)" as DatabaseContainer

node "Reverse Proxy Container\n(dinner_service_caddy)" as ReverseProxyContainer

node "Google Gemini API\n(External SaaS)" as GeminiAPI

node "OpenAI API\n(External SaaS)" as OpenAIAPI

node "Mock Payment Gateway\n(External Service)" as PaymentGW


' ==========================================
' 4. 물리적 연결 (Physical Connections)
' ==========================================
ClientBrowser -- ReverseProxyContainer : HTTP/HTTPS\n(80, 443)
ReverseProxyContainer -- FrontendContainer : HTTP\n(3000)
ReverseProxyContainer -- BackendContainer : HTTP\n(8000)
BackendContainer -- DatabaseContainer : TCP\n(5432)
BackendContainer -- GeminiAPI : HTTPS
BackendContainer -- OpenAIAPI : HTTPS
BackendContainer -- PaymentGW : HTTPS


' ==========================================
' 5. 배포 관계 (Deployment Relationships)
' ==========================================
CustomerApp ..> ClientBrowser : <<deploy>>
AdminApp ..> ClientBrowser : <<deploy>>
CommonComp ..> ClientBrowser : <<deploy>>

ApiRouters ..> BackendContainer : <<deploy>>
DomainServices ..> BackendContainer : <<deploy>>
IntegrationRealtime ..> BackendContainer : <<deploy>>
Persistence ..> BackendContainer : <<deploy>>

LLM ..> GeminiAPI : <<deploy>>
StableDiffusion ..> GeminiAPI : <<deploy>>

STT ..> OpenAIAPI : <<deploy>>
TTS ..> OpenAIAPI : <<deploy>>


' ==========================================
' 6. 구현 관계 (Implementation Relationships)
' ==========================================
NextServer ..> FrontendContainer : <<implementation>>
BuildDir ..> FrontendContainer : <<implementation>>

MainPy ..> BackendContainer : <<implementation>>
Uvicorn ..> BackendContainer : <<implementation>>

PostgresExe ..> DatabaseContainer : <<implementation>>
PgData ..> DatabaseContainer : <<implementation>>

CaddyExe ..> ReverseProxyContainer : <<implementation>>
CaddyConf ..> ReverseProxyContainer : <<implementation>>


' ==========================================
' 7. 레이아웃 조정을 위한 히든 링크
' ==========================================
CustomerApp -[hidden]right- AdminApp
AdminApp -[hidden]right- CommonComp

ApiRouters -[hidden]right- DomainServices
DomainServices -[hidden]right- IntegrationRealtime
IntegrationRealtime -[hidden]right- Persistence

LLM -[hidden]right- StableDiffusion
STT -[hidden]right- TTS

NextServer -[hidden]right- BuildDir
MainPy -[hidden]right- Uvicorn
PostgresExe -[hidden]right- PgData
CaddyExe -[hidden]right- CaddyConf

CustomerApp -[hidden]down- ClientBrowser
ApiRouters -[hidden]down- BackendContainer
NextServer -[hidden]down- FrontendContainer
PostgresExe -[hidden]down- DatabaseContainer
CaddyExe -[hidden]down- ReverseProxyContainer
LLM -[hidden]down- GeminiAPI
STT -[hidden]down- OpenAIAPI

ClientBrowser -[hidden]right- ReverseProxyContainer
FrontendContainer -[hidden]right- BackendContainer
BackendContainer -[hidden]right- DatabaseContainer
GeminiAPI -[hidden]right- OpenAIAPI

@enduml
