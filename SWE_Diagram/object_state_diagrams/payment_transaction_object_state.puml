@startuml
title "Payment Status State Diagram (Order.payment_status)"
skinparam shadowing false
skinparam state {
  BackgroundColor #LightGoldenRodYellow
  BorderColor #555
  RoundCorner 10
}

' --- States ---
state "Payment Pending\n(PENDING)" as Pending
state "Payment Completed\n(PAID)" as Paid
state "Payment Failed\n(FAILED)" as Failed
state "Refunded\n(REFUNDED)" as Refunded

' --- Transitions ---

' Entry Point
' OrderService.create_order() before PaymentService call
' orders.payment_status always starts as PENDING
[*] --> Pending : OrderService.create_order()\n(order_service.py:685)\npayment_status='PENDING'

' From PENDING state
Pending --> Paid : PaymentService.process_mock_payment()\n(payment_service.py:92)\nsuccess â†’ payment_status='PAID'
Pending --> Failed : PaymentService.process_mock_payment()\n(payment_service.py:96)\nfailure â†’ payment_status='FAILED'

' From PAID state
Paid --> Refunded : cancel_order()\n(order.py:680)\norder_status='CANCELLED',\npayment_status='REFUNDED'

' End States
Paid --> [*]
Failed --> [*]
Refunded --> [*]

@enduml