@startuml
title "Event Promotion State Diagram (event_promotions)"
skinparam shadowing false
skinparam state {
  BackgroundColor #LightGoldenRodYellow
  BorderColor #555
  RoundCorner 10
}

' --- States ---
state "Draft\n(is_published=false)" as Draft
state "Scheduled\n(is_published=true,\nstart_date>today)" as Scheduled
state "Active\n(is_published=true,\nwithin date range)" as Active
state "Ended\n(is_published=false\nor date passed)" as Ended

' --- Transitions ---

' Entry Point
[*] --> Draft : EventService.create_event()\n(event_service.py:352)\nis_published=false

' From Draft state
Draft --> Scheduled : EventService.update_event()\n(event_service.py:436)\nis_published=true,\nstart_date>today
Draft --> Active : EventService.update_event()\n(event_service.py:436)\nis_published=true,\nstart_date<=today
Draft --> Ended : EventService.delete_event()\n(event_service.py:467)\nor update is_published=false

' From Scheduled state
Scheduled --> Active : Automatic transition\n(event_service.py:574)\nstart_date reached\n(today>=start_date)
Scheduled --> Ended : EventService.update_event()\n(event_service.py:436)\nis_published=false

' From Active state
Active --> Ended : Automatic transition\n(event_service.py:574)\nend_date passed\nor is_published=false

' End State
Ended --> [*]

@enduml