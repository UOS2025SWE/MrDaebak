11 "External Systems" 서브시스템 세부 설계

"External Systems" 시스템은 외부 API 및 서비스와의 통합을 담당한다.

AI 기반 기능 제공을 위해 Google Gemini API와 통합한다.
음성 변환 기능 제공을 위해 OpenAI Audio API와 통합한다.
결제 처리를 위해 Mock Payment Gateway와 통합한다.
각 외부 시스템은 인터페이스로 정의되어 있으며, 실제 구현은 해당 외부 서비스가 제공한다.
API 키 관리 및 인증을 처리하며, 환경 변수를 통해 안전하게 관리한다.
외부 API 호출 실패 시 재시도 로직 및 에러 핸들링을 수행한다.
외부 API 응답을 파싱하여 내부 시스템에서 사용 가능한 형태로 변환한다.

"External Systems" 시스템은 아래와 같은 중요한 외부 API 인터페이스들로 구성되어 있다.

Gemini LLM API
Google Gemini 2.0 Flash 모델과의 통합을 제공하는 외부 API 인터페이스이다.
자연어 이해, 대화 생성, 이미지 생성 및 편집 기능을 제공한다.
generate_content(model, contents) 함수는 Gemini 모델을 사용하여 텍스트를 생성한다.
음성 주문 분석 시 사용자의 자연어 입력을 이해하고, 의도를 파악하며, 적절한 응답을 생성한다.
대화 컨텍스트를 유지하며, 이전 대화 내용을 기반으로 연속적인 대화를 지원한다.
model 파라미터에 사용할 Gemini 모델을 지정하며, "gemini-2.0-flash-exp" 등의 값을 가진다.
contents 파라미터에 프롬프트 및 대화 이력을 전달한다.
응답 객체를 반환하며, 생성된 텍스트, 신뢰도, 메타데이터 등을 포함한다.
generate_images(prompt, aspect_ratio) 함수는 Gemini Imagen 모델을 사용하여 이미지를 생성한다.
커스텀 케이크 주문 시 고객이 입력한 프롬프트를 기반으로 케이크 이미지를 생성한다.
prompt 파라미터에 이미지 생성 프롬프트를 전달하며, "초콜릿 케이크에 딸기 장식" 등의 자연어 설명을 사용한다.
aspect_ratio 파라미터에 이미지 비율을 지정하며, "1:1", "16:9", "9:16" 등의 값을 가진다.
생성된 이미지 바이너리 데이터를 포함하는 응답 객체를 반환한다.
edit_images(base_image, prompt) 함수는 기존 이미지를 프롬프트에 따라 편집한다.
base_image 파라미터에 편집할 원본 이미지를 전달하고, prompt 파라미터에 편집 지시사항을 전달한다.
편집된 이미지 바이너리 데이터를 포함하는 응답 객체를 반환한다.

OpenAI Audio API
OpenAI Whisper 및 TTS 모델과의 통합을 제공하는 외부 API 인터페이스이다.
음성 인식(STT) 및 음성 합성(TTS) 기능을 제공한다.
audio.transcriptions.create(file, model) 함수는 음성 파일을 텍스트로 변환한다.
OpenAI Whisper 모델을 사용하며, 정확한 음성 인식을 제공한다.
file 파라미터에 음성 파일을 전달하며, MP3, WAV, M4A, WEBM 등의 포맷을 지원한다.
model 파라미터에 사용할 Whisper 모델을 지정하며, "whisper-1" 등의 값을 가진다.
다국어 지원이 가능하며, 한국어, 영어, 일본어 등 다양한 언어의 음성을 인식할 수 있다.
인식된 텍스트를 포함하는 응답 객체를 반환한다.
audio.speech.create(input, voice) 함수는 텍스트를 음성으로 변환한다.
OpenAI TTS 모델을 사용하며, 자연스러운 음성을 생성한다.
input 파라미터에 음성으로 변환할 텍스트를 전달한다.
voice 파라미터에 음성 타입을 지정하며, "alloy", "echo", "fable", "onyx", "nova", "shimmer" 등의 값을 가진다.
각 음성 타입은 고유한 특성을 가지며, 남성 음성, 여성 음성, 중성적인 음성 등 다양한 선택지를 제공한다.
생성된 음성 바이너리 데이터를 포함하는 응답 객체를 반환하며, MP3, WAV, OPUS 등의 포맷으로 제공된다.

Mock Payment Gateway
결제 처리를 시뮬레이션하는 외부 결제 게이트웨이 인터페이스이다.
실제 결제 처리는 수행하지 않으며, 개발 및 테스트 목적으로 사용된다.
process_payment(card_number, amount) 함수는 결제를 처리한다.
card_number 파라미터에 카드 번호를 전달하고, amount 파라미터에 결제 금액을 전달한다.
카드 번호 유효성을 검증하며, Luhn 알고리즘을 사용하여 카드 번호의 유효성을 확인한다.
결제 성공 시 거래 ID를 생성하고, 결제 상태를 "SUCCESS"로 반환한다.
결제 실패 시 에러 코드 및 에러 메시지를 반환한다.
응답 객체는 거래 ID, 결제 상태, 승인 번호, 결제 시간 등을 포함한다.
verify_card(card_number) 함수는 카드 번호의 유효성을 검증한다.
Luhn 알고리즘을 사용하여 카드 번호가 유효한 형식인지 확인한다.
유효한 카드 번호인 경우 true를 반환하고, 유효하지 않은 경우 false를 반환한다.


11.1 메인 클래스도

Gemini LLM API (external interface)

Gemini LLM API는 Google Cloud AI Platform을 통해 제공되는 외부 API이다.
API 키 인증을 통해 접근하며, 환경 변수 GEMINI_API_KEY에 API 키를 저장한다.
generate_content(model, contents) 함수는 HTTP POST 요청을 통해 Gemini API 엔드포인트로 프롬프트를 전송한다.
요청 본문에 모델명, 프롬프트, 대화 이력, 생성 파라미터(temperature, max_tokens 등)를 포함한다.
응답은 JSON 형태로 반환되며, 생성된 텍스트, 신뢰도, 사용된 토큰 수 등을 포함한다.
generate_images(prompt, aspect_ratio) 함수는 Gemini Imagen API 엔드포인트로 이미지 생성 요청을 전송한다.
요청 본문에 프롬프트, 이미지 비율, 생성 파라미터를 포함한다.
응답은 이미지 바이너리 데이터를 base64 인코딩하여 반환한다.
edit_images(base_image, prompt) 함수는 Gemini Imagen API 엔드포인트로 이미지 편집 요청을 전송한다.
요청 본문에 원본 이미지, 편집 프롬프트, 편집 파라미터를 포함한다.
"AI & Realtime Domain" 시스템의 GeminiService 및 GeminiImageService가 이 인터페이스를 사용한다.

OpenAI Audio API (external interface)

OpenAI Audio API는 OpenAI Platform을 통해 제공되는 외부 API이다.
API 키 인증을 통해 접근하며, 환경 변수 OPENAI_API_KEY에 API 키를 저장한다.
audio.transcriptions.create(file, model) 함수는 HTTP POST 요청을 통해 OpenAI Whisper API 엔드포인트로 음성 파일을 전송한다.
요청은 multipart/form-data 형식으로 전송되며, 음성 파일 및 모델명을 포함한다.
선택적으로 language 파라미터를 전달하여 음성 언어를 지정할 수 있으며, 자동 감지도 가능하다.
응답은 JSON 형태로 반환되며, 인식된 텍스트, 신뢰도, 처리 시간 등을 포함한다.
audio.speech.create(input, voice) 함수는 HTTP POST 요청을 통해 OpenAI TTS API 엔드포인트로 텍스트를 전송한다.
요청 본문에 텍스트, 음성 타입, 오디오 포맷, 생성 파라미터를 포함한다.
응답은 생성된 음성 바이너리 데이터를 반환하며, Content-Type 헤더에 오디오 MIME 타입을 포함한다.
"AI & Realtime Domain" 시스템의 OpenAIAudioService가 이 인터페이스를 사용한다.

Mock Payment Gateway (external interface)

Mock Payment Gateway는 실제 결제 시스템을 시뮬레이션하는 개발용 인터페이스이다.
실제 금융 네트워크와 통신하지 않으며, 로컬에서 결제 로직을 시뮬레이션한다.
process_payment(card_number, amount) 함수는 결제 프로세스를 시뮬레이션한다.
카드 번호의 마지막 자리가 짝수인 경우 결제 성공, 홀수인 경우 결제 실패로 시뮬레이션할 수 있다.
거래 ID는 UUID 형태로 생성되며, 고유한 거래 식별자를 제공한다.
결제 상태는 "SUCCESS", "FAILED", "PENDING" 중 하나이며, 시뮬레이션 로직에 따라 결정된다.
응답 객체는 거래 ID, 결제 상태, 승인 번호, 결제 시간, 에러 코드, 에러 메시지 등을 포함한다.
verify_card(card_number) 함수는 Luhn 알고리즘을 사용하여 카드 번호 유효성을 검증한다.
Luhn 알고리즘은 체크섬 계산을 통해 카드 번호가 유효한 형식인지 확인하는 표준 알고리즘이다.
카드 번호의 각 자리 숫자를 홀수 위치와 짝수 위치로 구분하여 계산하고, 합계가 10으로 나누어떨어지면 유효한 카드 번호로 판단한다.
"Order & Checkout Domain" 시스템의 PaymentService가 이 인터페이스를 사용한다.
실제 운영 환경에서는 PG사(Toss Payments, KG Inicis, NHN KCP 등)의 실제 결제 API로 대체된다.
