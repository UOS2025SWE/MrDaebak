8 "Staff Management Domain" 서브시스템 세부 설계

"Staff Management Domain" 시스템은 직원 포지션 배정과 성과 추적을 관리하는 백엔드 시스템이다.

신규 직원의 포지션을 배정하며, COOK(요리사) 또는 DELIVERY(배달원) 중 하나를 선택할 수 있다.
포지션이 배정되지 않은 대기 중인 직원 목록을 조회할 수 있다.
직원 해고 처리 및 해고 사유 기록 기능을 제공한다.
직원별 성과를 추적하며, 완료한 주문 수, 평균 처리 시간, 고객 평가 등의 정보를 관리한다.
매니저 대시보드를 위한 통계 정보를 제공하며, 총 매출, 주문 수, 직원 수 등을 조회할 수 있다.
최근 주문 현황 및 직원 요약 정보를 제공하여 시스템 모니터링을 지원한다.
판매 및 재고 리포트 생성 기능을 제공한다.
Pydantic 모델을 활용하여 요청/응답 데이터 유효성을 검증한다.

"Staff Management Domain" 시스템은 아래와 같은 중요한 라우터와 서비스들로 구성되어 있다.

StaffRouter
직원 관리 관련 모든 엔드포인트를 제공하는 라우터이다.
GET /api/staff/ 엔드포인트는 전체 직원 목록을 조회하며, 각 직원의 ID, 이름, 이메일, 포지션, 근무 상태, 현재 배정된 주문 상태를 반환한다.
GET /api/staff/pending 엔드포인트는 포지션이 배정되지 않은 대기 중인 직원 목록을 조회한다.
신규 가입한 직원은 포지션이 null 상태로 대기하며, 매니저가 포지션을 배정해야 업무를 시작할 수 있다.
POST /api/staff/{staff_id}/assign-position 엔드포인트는 특정 직원에게 포지션을 배정하며, AssignPositionRequest 모델을 통해 포지션 정보를 검증한다.
포지션은 COOK 또는 DELIVERY 값을 가지며, 배정 후 직원은 해당 포지션의 업무를 수행할 수 있다.
POST /api/staff/{staff_id}/terminate 엔드포인트는 특정 직원을 해고하며, TerminateStaffRequest 모델을 통해 해고 사유를 검증한다.
해고된 직원의 계정은 비활성화되며, 더 이상 시스템에 로그인할 수 없다.
GET /api/staff/{staff_id}/performance 엔드포인트는 특정 직원의 성과 정보를 조회한다.
완료한 주문 수, 평균 주문 처리 시간, 고객 평가 평균, 최근 30일 성과 추이 등의 정보를 반환한다.

AdminRouter
매니저 대시보드 관련 엔드포인트를 제공하는 라우터이다.
GET /api/admin/dashboard/stats 엔드포인트는 대시보드 통계 정보를 조회한다.
총 매출, 오늘의 매출, 총 주문 수, 오늘의 주문 수, 활성 직원 수, 평균 주문 금액 등의 정보를 반환한다.
GET /api/admin/dashboard/recent-orders 엔드포인트는 최근 주문 목록을 조회한다.
주문 번호, 고객명, 주문 시간, 상태, 금액, 배정된 직원 정보 등을 포함하며, 최근 20개의 주문을 반환한다.
GET /api/admin/dashboard/staff-summary 엔드포인트는 직원 요약 정보를 조회한다.
포지션별 인원 수(요리사 N명, 배달원 M명), 현재 근무 중인 직원 수, 평균 성과 등의 정보를 반환한다.
GET /api/admin/reports/sales 엔드포인트는 판매 리포트를 생성하고 다운로드한다.
기간별 매출, 메뉴별 판매량, 시간대별 주문 분포 등의 정보를 CSV 또는 PDF 형식으로 제공한다.
GET /api/admin/reports/inventory 엔드포인트는 재고 리포트를 생성하고 다운로드한다.
현재 재고 현황, 재고 부족 재료 목록, 입고 예정 정보 등을 CSV 또는 PDF 형식으로 제공한다.


8.1 메인 클래스도

AssignPositionRequest (Pydantic 모델)

AssignPositionRequest는 직원 포지션 배정 시 사용되는 요청 데이터 모델이다.
position 변수에 배정할 포지션을 저장하며, "COOK" 또는 "DELIVERY" 값을 가진다.

TerminateStaffRequest (Pydantic 모델)

TerminateStaffRequest는 직원 해고 시 사용되는 요청 데이터 모델이다.
reason 변수에 해고 사유를 저장하며, null인 경우 사유 없이 해고 처리된다.

StaffService (services/staff_service.py)

StaffService는 직원 관리 및 매니저 대시보드 관련 비즈니스 로직을 처리하는 서비스 클래스이다.
get_staff_with_order_status(db) 함수는 전체 직원 목록을 조회하며, 각 직원의 현재 배정된 주문 상태를 함께 반환한다.
요리사의 경우 PREPARING 상태의 주문 수를, 배달원의 경우 IN_DELIVERY 상태의 주문 수를 표시한다.
get_pending_staff(db) 함수는 포지션이 배정되지 않은 대기 중인 직원 목록을 조회한다.
포지션이 null인 직원만 필터링하여 반환하며, 가입 날짜 순으로 정렬한다.
assign_position(db, staff_id, position) 함수는 특정 직원에게 포지션을 배정한다.
포지션은 COOK 또는 DELIVERY 값을 가지며, 배정 후 직원 상태를 ACTIVE로 변경한다.
이미 포지션이 배정된 직원에게는 에러를 발생시킨다.
terminate_staff(db, staff_id, reason) 함수는 특정 직원을 해고 처리한다.
직원 상태를 TERMINATED로 변경하고, 해고 사유를 기록하며, 해고 날짜를 저장한다.
해고된 직원은 더 이상 시스템에 로그인할 수 없으며, 배정된 주문은 다른 직원에게 재배정된다.
get_staff_performance(db, staff_id) 함수는 특정 직원의 성과 정보를 조회한다.
완료한 총 주문 수를 계산하며, 요리사의 경우 READY_FOR_DELIVERY 상태로 변경한 주문 수를, 배달원의 경우 DELIVERED 상태로 변경한 주문 수를 집계한다.
평균 주문 처리 시간을 계산하며, 주문 배정 시각부터 완료 시각까지의 평균 시간을 분 단위로 반환한다.
고객 평가 평균을 계산하며, 해당 직원이 처리한 주문의 고객 평가 점수 평균을 반환한다.
최근 30일간의 성과 추이를 조회하며, 날짜별 완료 주문 수를 그래프 형태로 표시할 수 있도록 데이터를 제공한다.
Database 인터페이스에 의존하여 PostgreSQL 데이터베이스와 통신한다.

Database (인터페이스)

"Staff Management Domain" 시스템의 모든 서비스는 Database 인터페이스를 통해 PostgreSQL 데이터베이스와 통신한다.
이 인터페이스는 실제로는 "Database Layer" 시스템에 구현되어 있으며, SQLAlchemy ORM을 통해 데이터베이스 작업을 수행한다.
