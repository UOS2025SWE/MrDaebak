Dinner Service System Level 3 컴포넌트 상세 설명

================================================================================


Frontend System - Level 3 컴포넌트 상세 구성
================================================================================

Customer Web App 컴포넌트

Customer Web App 컴포넌트는 13개의 페이지로 구성되어 있다.

HomePage는 메인 페이지로 프로모션과 이벤트를 안내한다. 배너 슬라이더를 통해 진행 중인 프로모션을 시각적으로 표시하고, 인기 메뉴를 카드 형태로 보여준다. 빠른 주문 버튼을 제공하여 사용자가 즉시 주문 페이지로 이동할 수 있도록 한다.

MenuPage는 메뉴 카탈로그를 표시하고 필터링 기능을 제공한다. 카테고리별 탭(French, English, Valentine, Champagne)으로 메뉴를 분류하며, 가격대별 필터와 인기순, 가격순 정렬 기능을 제공한다. 각 메뉴 카드에는 이미지, 이름, 가격, 간단한 설명이 표시되고, 상세보기 버튼을 클릭하면 메뉴 상세 정보를 모달로 보여준다.

OrderPage는 GUI 방식의 주문 생성을 담당한다. 메뉴 선택, 서빙 스타일 선택(Simple, Grand, Deluxe), 수량 입력, 재료 커스터마이징을 단계별로 처리한다. 선택한 메뉴의 이미지와 가격을 실시간으로 업데이트하여 표시하고, 장바구니에 담기 버튼으로 주문 항목을 추가한다. 장바구니 요약을 사이드바에 표시하여 총 금액과 항목 수를 확인할 수 있게 한다.

VoicePage는 음성 주문 인터페이스를 제공한다. 마이크 버튼을 클릭하여 음성 녹음을 시작하고, MediaRecorder API로 음성을 캡처한다. 녹음된 음성을 서버로 전송하여 STT로 변환하고, 변환된 텍스트를 화면에 표시한다. AI 응답을 TTS로 변환하여 자동 재생하며, 대화 히스토리를 채팅 형태로 표시한다. 주문 진행 단계를 Progress Bar로 시각화하여 현재 어느 단계인지 보여준다.

CheckoutPage는 결제를 처리한다. 주문 요약을 표시하고, 배송 정보 입력 폼(주소, 연락처, 배송 요청사항)을 제공한다. 결제 정보 입력 폼(카드번호, 유효기간, CVC, 카드소유자명)을 제공하며, 입력 값의 유효성을 실시간으로 검증한다. 할인 쿠폰 입력란을 제공하고 적용 버튼으로 할인을 적용한다. 최종 결제 금액을 계산하여 표시하고, 결제하기 버튼으로 결제를 완료한다.

OrdersPage는 주문 내역을 조회한다. 사용자의 전체 주문 목록을 테이블 형태로 표시하고, 주문번호, 주문일시, 상태, 총금액을 각 행에 표시한다. 주문 상태별 필터(전체, 대기, 조리중, 배달중, 완료)를 제공하고, 날짜 범위 필터로 특정 기간의 주문을 조회할 수 있게 한다. 주문 상세보기 버튼을 클릭하면 주문 상세 정보를 모달로 보여준다.

OrderCompletePage는 주문 완료를 확인한다. 주문 성공 메시지와 주문번호를 표시하고, 주문 상세 정보(메뉴, 수량, 금액)를 요약하여 보여준다. 예상 배달 시간을 표시하고, 주문 추적 버튼으로 OrdersPage로 이동할 수 있게 한다. 홈으로 돌아가기 버튼을 제공한다.

EventsPage는 이벤트 및 프로모션 정보를 보여준다. 진행 중인 이벤트를 카드 형태로 나열하고, 각 카드에 이벤트 이미지, 제목, 기간, 할인율을 표시한다. 이벤트 상세보기를 클릭하면 이벤트 설명과 참여 방법을 모달로 보여준다. 종료된 이벤트는 별도 탭으로 분리하여 표시한다.

ProfilePage는 사용자 프로필을 관리한다. 사용자 정보(이름, 이메일, 전화번호)를 표시하고 수정 폼을 제공한다. 비밀번호 변경 버튼을 클릭하면 ChangePasswordModal을 띄운다. 최근 주문 내역 요약을 표시하고, 전체 주문 내역 보기 버튼으로 OrdersPage로 이동할 수 있게 한다. 회원 탈퇴 버튼을 제공한다.

RegisterPage는 회원가입을 처리한다. 이메일, 비밀번호, 비밀번호 확인, 이름, 전화번호 입력 폼을 제공한다. 각 필드의 유효성을 실시간으로 검증하고(이메일 형식, 비밀번호 강도, 전화번호 형식), 에러 메시지를 필드 아래에 표시한다. 이미 존재하는 이메일인지 중복 확인을 수행하고, 회원가입 버튼으로 가입을 완료한다. 가입 완료 후 자동으로 LoginPage로 이동한다.

LoginPage는 로그인을 처리한다. 이메일과 비밀번호 입력 폼을 제공하고, 로그인 버튼으로 인증을 수행한다. 로그인 실패 시 에러 메시지를 표시하고, 성공 시 JWT 토큰을 로컬 스토리지에 저장한다. 회원가입 링크를 제공하여 RegisterPage로 이동할 수 있게 하고, 비밀번호 찾기 링크를 제공한다(향후 구현).

AboutPage는 서비스 소개를 담당한다. 회사 소개, 서비스 특징, 주요 메뉴 소개를 섹션별로 표시한다. 팀 소개와 연락처 정보를 제공하고, FAQ 섹션으로 자주 묻는 질문에 대한 답변을 보여준다.

ContactPage는 문의를 처리한다. 문의 폼(이름, 이메일, 제목, 내용)을 제공하고, 문의 제출 버튼으로 서버에 전송한다. 제출 완료 시 성공 메시지를 표시하고, 응답 예상 시간을 안내한다. 전화번호, 이메일, 주소 등의 연락처 정보를 표시하고, 지도 임베드로 위치를 보여준다(향후 구현).


Admin & Staff Web App 컴포넌트

Admin & Staff Web App 컴포넌트는 4개의 페이지로 구성되어 있다.

AdminDashboard는 관리자 전용 대시보드로 전체 통계 및 모니터링을 제공한다. 오늘의 주문 수, 매출, 신규 고객 수를 카드 형태로 표시하고, 실시간 주문 현황을 테이블로 보여준다. 주문 상태별 개수를 도넛 차트로 시각화하고, 시간대별 주문 추이를 라인 차트로 표시한다. 인기 메뉴 TOP 5를 바 차트로 보여주고, 재고 부족 알림을 배지로 표시한다. 빠른 액션 버튼(메뉴 추가, 이벤트 생성)을 제공한다.

StaffDashboard는 직원 전용 대시보드로 역할별 작업 목록을 보여준다. 로그인한 직원의 역할(Cook, Delivery, Manager)에 따라 다른 화면을 표시한다. Cook 역할은 조리 대기 주문 목록을 우선순위 순으로 표시하고, 각 주문의 메뉴, 수량, 특별 요청사항을 보여준다. 조리 시작 버튼으로 상태를 업데이트하고, 조리 완료 버튼으로 배달 대기 상태로 변경한다. Delivery 역할은 배달 대기 주문 목록을 표시하고, 고객 주소와 연락처를 보여준다. 배달 시작 버튼으로 배달 중 상태로 변경하고, 배달 완료 버튼으로 주문을 완료한다. Manager 역할은 AdminDashboard와 유사한 통계를 표시하되, 직원 관리 메뉴를 추가로 제공한다.

ManagePage는 메뉴, 재고, 이벤트 관리를 통합하여 제공한다. 탭으로 메뉴 관리, 재고 관리, 이벤트 관리, 직원 관리를 분리한다. 메뉴 관리 탭은 메뉴 목록을 테이블로 표시하고, 추가/수정/삭제 버튼을 제공한다. 메뉴 폼(이름, 가격, 카테고리, 설명, 이미지 업로드)을 모달로 보여준다. 재고 관리 탭은 재료 목록과 현재 재고량을 표시하고, 입고/출고 버튼으로 재고를 업데이트한다. 재고 부족 재료를 하이라이트 표시한다. 이벤트 관리 탭은 이벤트 목록을 표시하고, 이벤트 폼(제목, 내용, 시작일, 종료일, 할인율, 이미지)을 제공한다. 직원 관리 탭은 직원 목록을 표시하고, 역할 변경과 계정 활성화/비활성화 기능을 제공한다.

StaffLoginPage는 직원 전용 로그인을 처리한다. 직원 ID와 비밀번호 입력 폼을 제공하고, 로그인 버튼으로 인증을 수행한다. 일반 고객 로그인과 분리하여 직원 전용 인증을 수행하고, 역할 정보를 JWT 토큰에 포함시킨다. 로그인 성공 시 역할에 따라 AdminDashboard 또는 StaffDashboard로 이동한다.


Common Components 컴포넌트

Common Components 컴포넌트는 6개의 재사용 가능한 UI 컴포넌트로 구성되어 있다.

Header 컴포넌트는 네비게이션 메뉴, 로고, 사용자 정보를 표시한다. 로고를 클릭하면 HomePage로 이동하고, 메뉴 링크(메뉴, 이벤트, 소개, 문의)를 제공한다. 로그인 상태에 따라 다른 UI를 표시하는데, 로그인 전에는 로그인/회원가입 버튼을 보여주고, 로그인 후에는 사용자 이름과 UserDropdown을 표시한다. 장바구니 아이콘에 담긴 항목 수를 배지로 표시하고, 클릭 시 OrderPage로 이동한다. 모바일에서는 햄버거 메뉴로 네비게이션을 토글한다.

Footer 컴포넌트는 하단 정보, 링크, 저작권을 표시한다. 회사 정보(주소, 전화번호, 이메일)를 왼쪽에 배치하고, 빠른 링크(메뉴, 이벤트, 이용약관, 개인정보처리방침)를 중앙에 표시한다. SNS 아이콘 링크(Facebook, Instagram, Twitter)를 오른쪽에 배치하고, 저작권 정보를 맨 아래에 표시한다.

UserDropdown 컴포넌트는 사용자 메뉴 드롭다운을 제공한다. 사용자 아바타를 클릭하면 드롭다운 메뉴가 열리고, 프로필, 주문내역, 비밀번호 변경, 로그아웃 메뉴를 표시한다. 프로필을 클릭하면 ProfilePage로 이동하고, 주문내역을 클릭하면 OrdersPage로 이동한다. 비밀번호 변경을 클릭하면 ChangePasswordModal을 띄우고, 로그아웃을 클릭하면 JWT 토큰을 삭제하고 LoginPage로 이동한다.

ProtectedRoute 컴포넌트는 인증된 사용자만 접근 가능한 라우트를 보호한다. JWT 토큰의 존재 여부를 확인하고, 없으면 LoginPage로 리다이렉트한다. 토큰이 있으면 유효성을 검증하고, 만료된 경우 LoginPage로 리다이렉트하며 에러 메시지를 표시한다. 토큰이 유효하면 자식 컴포넌트를 렌더링한다. 역할 기반 접근 제어를 지원하여 특정 역할만 접근 가능한 페이지를 보호한다(예: AdminDashboard는 Manager만 접근 가능).

ToastContainer 컴포넌트는 전역 알림 메시지를 표시한다. 성공, 오류, 경고, 정보 타입의 토스트 메시지를 지원하고, 각 타입에 따라 다른 색상과 아이콘을 표시한다. 토스트는 화면 우측 상단에 표시되고, 3초 후 자동으로 사라진다. 닫기 버튼을 클릭하면 즉시 사라지고, 여러 개의 토스트가 쌓이면 세로로 정렬하여 표시한다. Context API를 통해 전역 상태로 관리되며, 어느 컴포넌트에서든 toast 함수를 호출하여 메시지를 표시할 수 있다.

ChangePasswordModal 컴포넌트는 비밀번호 변경 모달 다이얼로그를 제공한다. 현재 비밀번호, 새 비밀번호, 새 비밀번호 확인 입력 폼을 제공한다. 새 비밀번호의 강도를 실시간으로 표시하고(약함, 보통, 강함), 두 개의 새 비밀번호 입력이 일치하는지 검증한다. 변경 버튼을 클릭하면 서버에 요청을 전송하고, 성공 시 토스트 메시지를 표시하며 모달을 닫는다. 실패 시 에러 메시지를 모달 내부에 표시한다. 취소 버튼이나 모달 외부를 클릭하면 모달을 닫는다.


================================================================================


Backend System - Level 3 컴포넌트 상세 구성
================================================================================

API Routers 컴포넌트

API Routers 컴포넌트는 14개의 Router 클래스로 구성되어 있다.

AdminRouter는 관리자 대시보드와 통계 조회를 제공한다. GET /api/admin/dashboard 엔드포인트는 오늘의 주문 수, 매출, 신규 고객 수를 반환하고, GET /api/admin/stats 엔드포인트는 기간별 통계(일별, 주별, 월별)를 반환한다. GET /api/admin/orders/realtime 엔드포인트는 실시간 주문 현황을 반환하고, GET /api/admin/menu/popular 엔드포인트는 인기 메뉴 순위를 반환한다. 모든 엔드포인트는 Manager 역할을 요구한다.

AuthRouter는 회원가입, 로그인, 로그아웃, 토큰 갱신을 처리한다. POST /api/auth/register 엔드포인트는 사용자 등록을 수행하고, 이메일 중복을 검증하며 비밀번호를 bcrypt로 해싱한다. POST /api/auth/login 엔드포인트는 이메일과 비밀번호로 인증을 수행하고, JWT 액세스 토큰과 리프레시 토큰을 반환한다. POST /api/auth/logout 엔드포인트는 리프레시 토큰을 무효화한다. POST /api/auth/refresh 엔드포인트는 리프레시 토큰으로 새로운 액세스 토큰을 발급한다.

CakeRouter는 AI 기반 케이크 이미지 생성 및 편집을 제공한다. POST /api/cake/customizations/generate-ai-image 엔드포인트는 텍스트 프롬프트와 가로세로 비율을 받아 이미지를 생성하고, 생성된 이미지의 경로와 파일명을 반환한다. POST /api/cake/customizations/edit-ai-image 엔드포인트는 원본 이미지 파일과 편집 프롬프트를 받아 이미지를 수정하고, 수정된 이미지의 경로를 반환한다. GET /api/cake/customizations/image/{filename} 엔드포인트는 저장된 이미지 파일을 반환한다.

CheckoutRouter는 결제 처리와 주문 확인을 수행한다. POST /api/checkout/pay 엔드포인트는 주문 ID, 결제 금액, 카드 정보를 받아 결제를 처리하고, 결제 ID, 거래 ID, 마스킹된 카드번호를 반환한다. GET /api/checkout/order/{order_id} 엔드포인트는 주문 상세 정보를 반환하고, POST /api/checkout/confirm 엔드포인트는 결제 확인 후 주문 상태를 업데이트한다.

DiscountRouter는 할인 쿠폰 적용과 할인 계산을 수행한다. POST /api/discount/apply 엔드포인트는 쿠폰 코드와 주문 금액을 받아 할인을 계산하고, 할인된 금액과 할인율을 반환한다. GET /api/discount/coupons 엔드포인트는 사용 가능한 쿠폰 목록을 반환하고, POST /api/discount/validate 엔드포인트는 쿠폰의 유효성을 검증한다.

EventsRouter는 이벤트 조회, 생성, 수정, 삭제를 관리한다. GET /api/events 엔드포인트는 활성 이벤트 목록을 반환하고, GET /api/events/{event_id} 엔드포인트는 이벤트 상세 정보를 반환한다. POST /api/events 엔드포인트는 새 이벤트를 생성하고(Manager 권한 필요), PUT /api/events/{event_id} 엔드포인트는 이벤트를 수정하며, DELETE /api/events/{event_id} 엔드포인트는 이벤트를 삭제한다.

IngredientsRouter는 재료 재고 조회와 입출고 관리를 담당한다. GET /api/ingredients 엔드포인트는 전체 재료 목록과 재고량을 반환하고, GET /api/ingredients/low-stock 엔드포인트는 재고 부족 재료 목록을 반환한다. POST /api/ingredients/{ingredient_id}/stock 엔드포인트는 재고 입고를 처리하고, PUT /api/ingredients/{ingredient_id}/stock 엔드포인트는 재고 출고를 처리한다.

InquiriesRouter는 고객 문의 접수 및 답변을 처리한다. GET /api/inquiries 엔드포인트는 문의 목록을 반환하고(관리자는 전체, 고객은 본인 문의만), POST /api/inquiries 엔드포인트는 새 문의를 접수한다. GET /api/inquiries/{inquiry_id} 엔드포인트는 문의 상세를 반환하고, POST /api/inquiries/{inquiry_id}/reply 엔드포인트는 답변을 작성한다(Manager 권한 필요).

MenuRouter는 메뉴 CRUD, 가격 조회, 카테고리 필터링을 처리한다. GET /api/menu 엔드포인트는 전체 메뉴 목록을 반환하고, GET /api/menu/{menu_id} 엔드포인트는 메뉴 상세를 반환한다. GET /api/menu/category/{category} 엔드포인트는 카테고리별 메뉴를 반환하고, POST /api/menu 엔드포인트는 새 메뉴를 추가한다(Manager 권한 필요). PUT /api/menu/{menu_id} 엔드포인트는 메뉴를 수정하고, DELETE /api/menu/{menu_id} 엔드포인트는 메뉴를 삭제한다.

OrderRouter는 주문 생성, 조회, 수정, 삭제, 상태 변경을 담당한다. GET /api/orders 엔드포인트는 주문 목록을 반환하고(고객은 본인 주문만, 직원은 전체), POST /api/orders 엔드포인트는 새 주문을 생성한다. GET /api/orders/{order_id} 엔드포인트는 주문 상세를 반환하고, PUT /api/orders/{order_id}/status 엔드포인트는 주문 상태를 업데이트한다(직원 권한 필요). DELETE /api/orders/{order_id} 엔드포인트는 주문을 취소한다.

SideDishesRouter는 사이드 디시를 관리한다. GET /api/side-dishes 엔드포인트는 사이드 디시 목록을 반환하고, POST /api/side-dishes 엔드포인트는 새 사이드 디시를 추가한다(Manager 권한 필요). PUT /api/side-dishes/{side_dish_id} 엔드포인트는 사이드 디시를 수정하고, DELETE /api/side-dishes/{side_dish_id} 엔드포인트는 사이드 디시를 삭제한다.

StaffRouter는 직원 계정 관리와 역할 권한 설정을 담당한다. GET /api/staff 엔드포인트는 직원 목록을 반환하고(Manager 권한 필요), POST /api/staff 엔드포인트는 새 직원 계정을 생성한다. GET /api/staff/{staff_id} 엔드포인트는 직원 정보를 반환하고, PUT /api/staff/{staff_id}/role 엔드포인트는 직원 역할을 변경한다. PUT /api/staff/{staff_id}/status 엔드포인트는 계정 활성화/비활성화를 처리한다.

VoiceRouter는 음성 녹음 파일 업로드, STT 변환, TTS 음성 생성을 담당한다. POST /api/voice/transcribe 엔드포인트는 음성 파일을 받아 텍스트로 변환하고, 변환된 텍스트와 함께 AI 분석 결과를 반환한다. POST /api/voice/synthesize 엔드포인트는 텍스트와 음성 옵션을 받아 음성으로 변환하고, MP3 바이너리를 반환한다. POST /api/voice/session 엔드포인트는 음성 주문 세션을 생성하고, GET /api/voice/session/{session_id} 엔드포인트는 세션 정보를 조회한다.

WebSocketRouter는 실시간 주문 상태 브로드캐스트를 처리한다. WS /api/ws/orders 엔드포인트는 WebSocket 연결을 수락하고, JWT 토큰으로 인증을 수행한다. 연결 수립 후 사용자 역할에 따라 다른 메시지를 전송하고, 주문 상태 변경 이벤트를 실시간으로 브로드캐스트한다. 메시지 형식은 JSON으로 type, data, timestamp를 포함한다.


Domain Services 컴포넌트

Domain Services 컴포넌트는 10개의 Service 클래스로 구성되어 있다.

OrderService는 주문 생성 및 유효성 검증을 수행한다. create_order 메서드는 메뉴 ID, 서빙 스타일, 수량, 커스터마이징을 받아 주문을 생성하고, 주문 최소 금액(10,000원)을 검증한다. 재고 충분성을 확인하고, 부족하면 예외를 발생시킨다. get_order 메서드는 주문 ID로 주문을 조회하고, get_user_orders 메서드는 사용자별 주문 목록을 반환한다. update_order_status 메서드는 주문 상태를 업데이트하고, WebSocketManager를 통해 실시간 알림을 전송한다. cancel_order 메서드는 주문을 취소하고, 결제 환불을 처리한다.

PaymentService는 Mock 결제 처리 및 검증을 수행한다. process_mock_payment 메서드는 카드 정보를 받아 결제를 처리하고, 카드번호 유효성을 검증한다(16자리 숫자). 카드번호를 마스킹하여 저장하고(****-****-****-1234), 거래 ID를 생성한다(TXN-XXXXXXXXXXXX). MOCK_PAYMENT_MODE 환경변수에 따라 결제 성공/실패를 결정하고, 결제 정보를 mock_payments 테이블에 저장한다. get_payment_info 메서드는 주문 ID로 결제 정보를 조회하고, get_user_payments 메서드는 사용자별 결제 내역을 반환한다.

DiscountService는 메뉴별, 이벤트별 할인율을 계산한다. calculate_discount 메서드는 주문 금액과 쿠폰 코드를 받아 할인 금액을 계산하고, 할인 최대 적용률(50%)을 검증한다. validate_coupon 메서드는 쿠폰의 유효성을 검증하고(유효기간, 사용 횟수 제한), apply_menu_discount 메서드는 메뉴별 할인을 적용한다. apply_event_discount 메서드는 이벤트 할인을 적용하고, 중복 할인 규칙을 적용한다(이벤트 할인과 쿠폰 할인 중 높은 것만 적용).

EventService는 이벤트 생성 및 관리를 담당한다. create_event 메서드는 제목, 내용, 시작일, 종료일, 할인율, 이미지를 받아 이벤트를 생성하고, get_active_events 메서드는 현재 진행 중인 이벤트 목록을 반환한다. get_event 메서드는 이벤트 ID로 이벤트를 조회하고, update_event 메서드는 이벤트를 수정한다. delete_event 메서드는 이벤트를 삭제하고, get_event_stats 메서드는 이벤트 통계(참여자 수, 할인 적용 횟수)를 집계한다.

MenuService는 메뉴 CRUD 작업을 수행한다. create_menu 메서드는 메뉴를 생성하고, get_menu 메서드는 메뉴 ID로 메뉴를 조회한다. get_all_menus 메서드는 전체 메뉴 목록을 반환하고, get_menus_by_category 메서드는 카테고리별 메뉴를 반환한다. update_menu 메서드는 메뉴를 수정하고, delete_menu 메서드는 메뉴를 삭제한다. get_popular_menus 메서드는 주문 횟수 기준으로 인기 메뉴 순위를 계산하고, update_menu_price 메서드는 메뉴 가격을 업데이트한다.

IngredientService는 재료 재고를 추적하고 입출고를 관리한다. get_ingredient 메서드는 재료 ID로 재료를 조회하고, get_all_ingredients 메서드는 전체 재료 목록을 반환한다. get_low_stock_ingredients 메서드는 재고 부족 재료 목록을 반환하고(재고량 < 최소 재고량), add_stock 메서드는 재고 입고를 처리한다. deduct_stock 메서드는 재고 출고를 처리하고, 재고가 부족하면 예외를 발생시킨다. predict_stock_depletion 메서드는 평균 사용량을 기반으로 재고 소진 예상 날짜를 계산한다.

InquiryService는 고객 문의를 접수하고 문의 답변을 작성한다. create_inquiry 메서드는 제목, 내용, 사용자 ID를 받아 문의를 생성하고, get_inquiry 메서드는 문의 ID로 문의를 조회한다. get_user_inquiries 메서드는 사용자별 문의 목록을 반환하고, get_all_inquiries 메서드는 전체 문의 목록을 반환한다(관리자 전용). create_reply 메서드는 문의에 대한 답변을 작성하고, 문의 상태를 '처리 중'에서 '완료'로 변경한다. 답변 작성 시 사용자에게 이메일 알림을 전송한다(향후 구현).

LoginService는 이메일과 비밀번호로 사용자를 인증한다. authenticate 메서드는 이메일로 사용자를 조회하고, bcrypt로 비밀번호를 검증한다. 인증 성공 시 JWT 액세스 토큰과 리프레시 토큰을 생성하고, 토큰에 사용자 ID, 이메일, 역할을 포함시킨다. verify_token 메서드는 JWT 토큰의 유효성을 검증하고, refresh_token 메서드는 리프레시 토큰으로 새 액세스 토큰을 발급한다. hash_password 메서드는 비밀번호를 bcrypt로 해싱하고, change_password 메서드는 비밀번호를 변경한다.

SideDishService는 사이드 디시 메뉴를 관리한다. create_side_dish 메서드는 사이드 디시를 생성하고, get_side_dish 메서드는 사이드 디시 ID로 조회한다. get_all_side_dishes 메서드는 전체 사이드 디시 목록을 반환하고, update_side_dish 메서드는 사이드 디시를 수정한다. delete_side_dish 메서드는 사이드 디시를 삭제하고, add_side_dish_to_order 메서드는 주문에 사이드 디시를 추가한다.

StaffService는 직원 계정을 생성 및 관리한다. create_staff 메서드는 직원 계정을 생성하고, 역할(Cook, Delivery, Manager)을 설정한다. get_staff 메서드는 직원 ID로 직원을 조회하고, get_all_staff 메서드는 전체 직원 목록을 반환한다. update_staff_role 메서드는 직원 역할을 변경하고, update_staff_status 메서드는 계정을 활성화/비활성화한다. get_staff_by_role 메서드는 역할별 직원 목록을 반환하고, record_work_hours 메서드는 직원 근무 시간을 기록한다(향후 구현).


Integration & Realtime 컴포넌트

Integration & Realtime 컴포넌트는 4개의 Adapter 클래스로 구성되어 있다.

GeminiService는 Google Gemini LLM API를 호출한다. analyze_voice_order 메서드는 음성 텍스트를 받아 주문 의도를 분석하고, intent(order/inquiry/other), confidence(0.0-1.0), response, order_state를 반환한다. manage_conversation_session 메서드는 ConversationSession 객체를 관리하고, 대화 히스토리를 최근 3개 메시지로 제한한다. inject_order_history 메서드는 사용자의 과거 주문 이력을 컨텍스트에 주입하고, inject_active_events 메서드는 진행 중인 이벤트 정보를 주입한다. generate_personalized_recommendation 메서드는 과거 주문 패턴을 분석하여 개인화 추천을 생성한다. ConversationSession 클래스는 session_id, messages, context, order_state, created_at 속성을 가진다.

GeminiImageService는 Google Gemini Image API를 호출한다. generate_image 메서드는 텍스트 프롬프트와 가로세로 비율을 받아 이미지를 생성하고, 케이크 전용 가드레일을 자동으로 추가한다. edit_image 메서드는 원본 이미지를 Base64로 인코딩하여 API에 전송하고, 편집 프롬프트를 적용하여 수정된 이미지를 생성한다. save_image 메서드는 생성된 이미지를 backend/uploads/cakes/ 경로에 UUID 파일명으로 저장하고, 이미지 경로를 반환한다. validate_aspect_ratio 메서드는 가로세로 비율이 지원되는 값인지 검증한다(1:1, 2:3, 3:2, 3:4, 4:3, 4:5, 5:4, 9:16, 16:9, 21:9).

OpenAIAudioService는 OpenAI Audio API를 호출한다. transcribe_audio 메서드는 음성 파일을 받아 텍스트로 변환하고, MIME 타입을 자동으로 감지한다(audio/webm, audio/mp3, audio/wav). BytesIO 버퍼로 변환하여 API에 전송하고, language="ko"로 한국어 인식을 최적화한다. synthesize_speech 메서드는 텍스트를 받아 음성으로 변환하고, voice 파라미터로 음성 옵션을 선택한다(nova, alloy, echo, fable, onyx, shimmer). response_format="mp3"로 MP3 출력을 생성하고, to_bytes() 또는 read() 또는 data 속성으로 바이너리를 추출한다. handle_api_error 메서드는 API 오류를 처리하고, exponential backoff로 재시도를 수행한다.

WebSocketManager는 WebSocket 연결을 관리한다. accept_connection 메서드는 WebSocket 연결을 수락하고, JWT 토큰으로 인증을 수행한다. 연결을 connection pool에 추가하고, 사용자 ID와 역할을 매핑한다. broadcast_order_update 메서드는 주문 상태 변경 메시지를 모든 연결에 브로드캐스트하고, 역할별 필터링을 적용한다(Cook에게는 조리 관련 알림만, Delivery에게는 배달 관련 알림만, Customer에게는 본인 주문만). send_message 메서드는 특정 연결에 메시지를 전송하고, close_connection 메서드는 연결을 종료하고 connection pool에서 제거한다. handle_disconnect 메서드는 연결 끊김을 감지하고, 재연결 로직을 수행한다.


Persistence 컴포넌트

Persistence 컴포넌트는 3개의 모듈로 구성되어 있다.

Database 모듈은 데이터베이스를 초기화하고 연결을 설정한다. init_db 함수는 SQLAlchemy Base.metadata.create_all()을 호출하여 테이블 스키마를 생성한다. check_connection 함수는 SELECT 1 쿼리를 실행하여 연결 상태를 확인하고, 실패 시 예외를 발생시킨다. get_db_version 함수는 SELECT version() 쿼리로 PostgreSQL 버전을 조회하고, 로그에 기록한다. close_db 함수는 모든 데이터베이스 연결을 종료하고, connection pool을 정리한다.

SessionLocal 모듈은 SQLAlchemy 세션 팩토리를 제공한다. sessionmaker()로 세션 팩토리를 생성하고, autocommit=False와 autoflush=False로 설정한다. get_db 함수는 FastAPI의 의존성 주입으로 세션을 자동 생성하고, yield로 세션을 반환한다. 요청 처리가 완료되면 finally 블록에서 세션을 닫고, 예외 발생 시 자동으로 롤백을 수행한다. 트랜잭션 범위는 요청 단위로 관리된다.

SQLAlchemy Engine 모듈은 Connection Pool을 관리한다. create_engine()으로 엔진을 생성하고, pool_pre_ping=True로 연결 유효성을 사전 검증한다. pool_recycle=3600으로 1시간마다 연결을 재생성하고, pool_size=5로 최대 연결 수를 설정한다. pool_timeout=30으로 연결 대기 시간을 30초로 제한하고, echo=False로 SQL 로그를 비활성화한다(프로덕션). max_overflow=10으로 추가 연결 생성을 허용하고, pool_pre_ping으로 stale connection을 방지한다.


================================================================================

이상으로 Frontend와 Backend의 Level 3 컴포넌트 상세 구성에 대한 설명을 마친다.
