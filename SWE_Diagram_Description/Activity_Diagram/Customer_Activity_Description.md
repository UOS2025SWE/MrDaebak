# 고객(Customer) Activity 서술

## 고객(Customer)의 일반적인 주문 흐름

일반적인 주문 흐름은 다음과 같다. 고객이 처음 시스템(웹 애플리케이션)을 이용할 때, 배달 주소, 연락처 등을 포함한 계정을 생성해야 하며, 기존 고객은 로그인을 수행한다[Manage Account].

로그인한 고객은 메인 페이지에서 새로운 주문을 시작하거나[Browse and Place Order], 과거 주문 내역을 기반으로 간편 재주문을 할 수 있다[Manage Past Orders]. 또한 음성 또는 텍스트 기반의 대화형 인터페이스를 통해 주문할 수도 있다[Order via Voice].

### 신규 주문 (GUI 경로)
고객은 홈 페이지 또는 메뉴 페이지에서 디너 패키지, 서빙 스타일, 사이드 디시, 음료 등을 탐색하며 원하는 항목과 수량을 선택한다. 디너 코스와 서빙 스타일의 조합이 유효한지 시스템이 검증하며, 고객은 재료 수량 조정, 사이드 디시 추가, 커스텀 케이크 주문 등을 통해 주문을 맞춤화할 수 있다.

특별한 날을 위해 커스텀 케이크 이미지를 요청할 경우[Request Custom Decoration], 고객은 원하는 문구를 입력하거나 참고 이미지를 업로드할 수 있으며, 시스템은 AI 이미지 생성(Stable Diffusion)을 통해 케이크 이미지를 생성할 수 있다.

### 음성 주문 (Voice 경로)
고객이 "음성 주문" 버튼을 클릭하여 음성 위젯을 열고 주문 요구사항을 말하면, 시스템은 STT 서비스(Whisper)를 통해 음성을 텍스트로 변환하고 LLM을 활용하여 고객의 과거 주문 이력 및 현재 활성화된 이벤트를 바탕으로 메뉴와 옵션을 추천한다. 고객이 추천된 구성을 확인하면 주문이 생성된다.

### 재주문 (Past Orders)
고객은 "주문 내역" 페이지에서 자신이 이전에 주문했던 것과 동일한 구성으로 "재주문" 버튼을 클릭하여 간편하게 주문할 수 있다. 시스템은 이전 주문의 메뉴, 스타일, 수량, 커스터마이징 정보를 자동으로 불러와 새로운 주문을 생성한다.

### 배달 정보 및 결제
모든 주문 경로는 배달 정보 확인 및 결제 단계로 이어진다. 고객은 배달 주소와 전화번호, 메모를 입력 또는 확인하고, 배달 날짜 및 시간대를 선택한다. 시스템은 재고 및 배달 스케줄을 검증하며[Validate Request], 재고 또는 배달 슬롯이 부족한 경우 대체 옵션을 제안한다.

주문이 검증되면 시스템은 고객의 등급(예: 단골)을 확인하여 할인을 자동으로 적용하고 최종 가격을 계산한다[Apply Loyalty Discount]. 고객은 카드 정보를 입력하고 "결제" 버튼을 클릭하여 결제를 진행한다[Make Payment]. 결제가 성공하면 주문 상태가 "RECEIVED"로 설정되며, 시스템은 WebSocket을 통해 실시간으로 주문 상태 변경 알림을 전송한다.

결제 실패 시 고객은 재시도하거나 주문을 포기할 수 있다.

### 주문 추적 및 완료
결제가 완료된 후, 고객은 "주문 상태 조회" 화면을 통해 자신의 주문이 현재 "접수됨(RECEIVED)", "조리 중(PREPARING)", "배달 중(DELIVERING)", "배달 완료(COMPLETED)" 중 어떤 상태인지 실시간으로 확인할 수 있다[Track Order Status]. WebSocket을 통해 상태가 변경될 때마다 알림을 수신한다.

배달이 완료되면 고객은 배달 확인 및 선택적으로 평가를 남길 수 있다.

### 배달 정보 관리
고객은 별도로 "배달 정보" 페이지를 통해 기본 배달 주소를 추가, 수정, 삭제할 수 있다[Manage Delivery Preferences]. 저장된 주소는 향후 주문 시 자동으로 불러와진다.

### 고객 지원
고객은 "문의/지원" 페이지를 통해 문의 제목과 내용을 작성하여 제출할 수 있다[Submit Support Inquiry]. 시스템은 문의를 저장하고 상태를 "NEW"로 설정하며, 확인 메시지를 표시한다.

---

## 주요 액티비티 상세 서술

### Manage Account
고객이 시스템을 이용하기 위해 회원가입, 로그인, 로그아웃을 수행한다. 회원가입 시 이메일, 비밀번호, 이름, 전화번호를 입력하며, 시스템은 JWT 토큰을 발급하여 인증 상태를 유지한다. 로그인 시 AuthContext가 localStorage에 저장된 토큰을 복원하여 세션을 유지한다. 대부분의 주문 및 조회 기능은 로그인을 전제로 한다.

### Browse and Place Order
고객이 시스템이 제공하는 메뉴(디너 패키지, 음료, 사이드 디시)를 그래픽 인터페이스(GUI)를 통해 탐색하고, 원하는 항목을 선택하여 주문서를 작성하는 가장 일반적인 주문 방식이다. 고객은 디너 패키지와 서빙 스타일을 선택하고, 수량과 옵션(바게트 개수, 음료, 사이드)을 조정할 수 있다. 시스템은 `/api/menu` 및 `/api/events`를 통해 메뉴 및 이벤트 정보를 불러온다.

### Order via Voice
고객이 음성을 통해 자연어로 주문을 요청하는 방식이다. 고객이 "음성 주문" 버튼을 클릭하면 음성 위젯이 열리고, STT 서비스(Whisper)가 오디오를 텍스트로 변환한다. 시스템은 LLM을 활용하여 고객의 과거 주문 이력과 활성 이벤트를 참고하여 메뉴, 스타일, 수량, 커스터마이징을 추천한다. 고객이 추천된 디너를 확인하면 주문이 생성되며, 이후 동일한 결제 플로우로 진행된다.

### Request Custom Decoration
고객이 커스텀 케이크에 대해 이미지 등 맞춤형 데코레이션을 요청하는 선택적 활동이다. 고객은 사진을 업로드하거나 AI 이미지 생성을 요청할 수 있으며, 시스템은 AI 이미지 생성 서비스(Stable Diffusion)를 호출하여 케이크 이미지를 생성하거나 기존 자산을 사용한다. 이는 [Browse and Place Order] 또는 [Order via Voice]의 확장(extend) 기능으로 작동할 수 있다.

### Manage Past Orders
고객이 자신이 주문했던 과거 이력을 날짜순으로 조회한다(`/api/orders/user/{user_id}`). 이 활동은 "간편 주문(재주문)" 기능의 기반이 되며, 고객은 "재주문" 버튼을 클릭하여 이전 주문과 동일한 내용으로 새로운 주문을 생성할 수 있다(`/api/orders/reorder/{order_id}`). 시스템은 이전 주문의 메뉴, 스타일, 수량을 자동으로 불러오지만, 배달 정보와 결제는 다시 입력해야 한다.

### Manage Delivery Preferences
고객이 "배달 정보" 페이지에서 저장된 배달 주소를 조회, 추가, 수정, 삭제한다(`/api/checkout/delivery-info/{user_id}`). 저장된 주소는 향후 주문 시 자동으로 불러와지며, 고객은 여러 주소를 등록할 수 있다.

### Validate Request
시스템이 주문 요청을 검증하는 내부 활동이다. OrderService가 재고 및 배달 스케줄을 확인하며, 재고가 부족하거나 배달 슬롯이 없는 경우 고객에게 대체 옵션을 제안한다. 고객이 대체 슬롯을 선택하거나 주문을 취소할 수 있다.

### Apply Loyalty Discount
시스템이 DiscountService를 통해 고객의 등급(단골 여부)을 확인하고 할인을 자동으로 적용한다. 최종 가격이 계산되어 고객에게 표시된다.

### Make Payment
고객이 주문서 작성을 완료하고, 카드 정보를 입력하여 결제를 진행한다. 시스템은 PaymentService를 통해 Mock Payment Gateway와 연동하여 결제를 처리한다. 결제가 성공하면 주문 상태가 "RECEIVED"로 설정되고, `payment_status`가 "PAID"로 업데이트된다. WebSocket을 통해 ORDER_STATUS_CHANGED 이벤트가 전송되며, 확인 이메일 또는 푸시 알림이 발송된다. 결제 실패 시 고객은 재시도하거나 주문을 포기할 수 있다. 이 활동은 모든 주문 방식([Browse and Place Order], [Manage Past Orders]의 재주문, [Order via Voice])의 마지막 단계에 포함(include)된다.

### Track Order Status
고객이 결제를 완료한 후, 자신의 주문이 현재 주방 및 배달 시스템에서 어떤 단계에 있는지(예: "접수됨(RECEIVED)", "조리 중(PREPARING)", "배달 중(DELIVERING)", "배달 완료(COMPLETED)") 실시간으로 확인한다. 초기 로드 시 `/api/orders/{id}`를 통해 주문 상태를 조회하고, WebSocket(`/ws/orders/{id}`)을 통해 실시간 상태 업데이트를 수신한다. 이는 고객이 원할 때 확인하는 선택적 활동이며, 시스템이 상태 변경 시 고객에게 푸시 알림을 보낼 수도 있다.

### Submit Support Inquiry
고객이 "지원/문의" 페이지를 열고 문의 제목과 내용을 작성하여 제출한다(`/api/inquiries`). 시스템은 InquiryService를 통해 문의를 저장하고 상태를 "NEW"로 설정하며, 확인 메시지와 함께 리디렉션한다. 이는 선택적 활동으로, 로그인 여부와 관계없이 이용 가능할 수 있다.
