# UC08: Deliver Orders

## 유즈케이스 ID
**MRD-CUS-UC08**

## 액터
- **주 액터**: Delivery Staff
- **부 액터**: 없음

## 요약
배달 담당자가 조리 완료된 주문을 픽업하여 고객에게 배달하고 주문 상태를 업데이트한다.

## 유형
**Primary**

## 참고 유즈케이스
- **Include**: 없음
- **Extend**: 없음

## 사전 조건
배달 담당자가 로그인되어 있으며 배달 가능한 주문(PREPARING 또는 DELIVERING 상태)이 존재한다

## 사후 조건
(성공 시) 주문 상태가 DELIVERING 또는 COMPLETED로 업데이트되고 재고가 차감되며 실시간 알림이 전송된다, (실패 시) 오류 메시지가 표시되고 상태가 유지된다

## 주흐름

1. 배달 담당자가 할당된 주문 목록 조회를 시스템에 요청한다
2. 시스템이 PREPARING/DELIVERING 상태의 주문 목록을 반환한다
3. 배달 담당자가 주문 ID와 함께 상태를 DELIVERING으로 업데이트 요청을 시스템에 제출한다
4. 시스템이 주문 상태를 업데이트하고 성공 메시지를 반환한다
5. 배달 담당자가 주문 ID와 함께 상태를 COMPLETED로 업데이트 요청을 시스템에 제출한다
6. 시스템이 주문 상태를 업데이트하고 재고를 차감하며 배달 완료 메시지를 반환한다

## 부흐름

### 2a. 할당된 주문 없음
(3) 시스템이 배달 담당자에게 할당된 주문이 없음을 감지한다.
(4) 시스템이 "현재 배달할 주문이 없습니다." 메시지를 표시한다.
유즈케이스 종료한다.

### 4a. 주문 상태 업데이트 실패 (DELIVERING)
(5) 시스템이 주문 상태를 업데이트할 수 없음을 감지한다.
(6) 시스템이 "주문 상태를 업데이트할 수 없습니다." 오류 메시지를 표시한다.
흐름 (1)로 복귀한다.

### 6a. 주문 상태 업데이트 실패 (COMPLETED)
(7) 시스템이 주문 상태를 업데이트할 수 없음을 감지한다.
(8) 시스템이 "배달 완료 처리에 실패했습니다." 오류 메시지를 표시한다.
흐름 (3)으로 복귀한다.

### 6b. 재고 차감 실패
(7) 시스템이 주문 재고를 차감하는 중 오류가 발생한다.
(8) 시스템이 "재고 업데이트에 실패했습니다. 관리자에게 문의하세요." 경고 메시지를 표시하지만 주문은 COMPLETED 상태로 처리한다.
유즈케이스 종료한다 (수동 재고 조정 필요).

## 제약사항
- 주문 상태는 PREPARING → DELIVERING → COMPLETED 순서로만 변경 가능하다.
- 배달 완료(COMPLETED) 시점에 주문에 사용된 재료의 재고가 자동으로 차감되며, WebSocket을 통해 고객에게 배달 완료 알림이 전송된다.
